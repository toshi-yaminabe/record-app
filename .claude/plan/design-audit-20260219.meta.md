# Design Integrity Audit — Meta Plan
**日時:** 2026-02-19
**対象:** record-app (~/apps/record-app)
**バージョン:** v2.0.0-beta.6

## 1. 設計思想概要

| # | 原則 | 出典 |
|---|------|------|
| P1 | 音声プライバシー最優先 — AES-256-GCM/SQLCipher暗号化、音声短期保持→即削除 | KNOWLEDGE.md, CLAUDE.md |
| P2 | UX体験定義(E1-E5) — 朝Start→終日自動→夕方2分→週末5分、コア要件は削除禁止 | KNOWLEDGE.md §9, ISSUES.md |
| P3 | 3層アーキテクチャ — API Route→Service Layer→Prisma/外部API、withApiミドルウェア統一 | KNOWLEDGE.md §1 |
| P4 | 状態遷移の厳密管理 — タスクマトリクス(ARCHIVED最終)、STTステータス、ルールツリーバリデーション | KNOWLEDGE.md §2 |
| P5 | オフラインファースト — SQLCipher統合キュー、リトライ(max5)→dead letter、冪等性 | KNOWLEDGE.md §5 |
| P6 | 分人ドメインモデル一貫性 — 3箇所同期、視覚署名(色+アイコン+形)、8件上限 | ui-concept.md, CLAUDE.md |
| P7 | コーディング規約 — イミュータビリティ、小ファイル(800行上限)、構造化ログ | グローバルルール |

## 2. 評価軸（ルーブリック）— 5項目統合版

| # | 評価項目 | 満点 | 重み | 加重満点 |
|---|----------|------|------|----------|
| 1 | セキュリティ・データ保護 | 100 | 0.20 | 20 |
| 2 | UX体験定義(E1-E5) + 分人ドメインモデル | 100 | 0.30 | 30 |
| 3 | サービス層・状態遷移アーキテクチャ | 100 | 0.20 | 20 |
| 4 | 文字起こしパイプライン(オフライン+サーバー) | 100 | 0.15 | 15 |
| 5 | コーディング規約準拠 | 100 | 0.15 | 15 |
| **合計** | | | **1.00** | **100** |

### 減点基準
- CRITICAL: -15〜-25
- HIGH: -5〜-14
- MEDIUM: -2〜-4
- LOW: -1

## 3. 実行プラン

Phase 3〜9の概要。再帰条件: 97点未満でPhase 3に戻る。
最大再帰: 3回。停止条件: 改善幅 < 2点が連続 or 最大再帰到達。

### チーム構成（3レイヤー）
- Layer A（機能要件）: バックエンドAPI群、Flutter録音パイプライン、Web UI
- Layer B（横断的関心事）: セキュリティ、コーディング規約
- Layer C（アーキテクチャ）: サービス層・状態遷移・分人モデル一貫性
