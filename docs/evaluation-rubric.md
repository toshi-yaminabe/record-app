# record-app 改善評価ルーブリック (100点満点)

> 各フェーズで97点以上を達成しない場合は再帰処理を実施する。

---

## カテゴリ A: アプリ起動安定性 (30点)

| # | 評価項目 | 配点 | 基準 |
|---|---------|------|------|
| A1 | Android APKビルド成功 | 5 | `flutter build apk --release` がエラーなし |
| A2 | Android起動→ホーム画面表示 | 10 | クラッシュ/ANR/白画面なく3秒以内にホーム表示 |
| A3 | Web `npm run build` 成功 | 5 | ビルドエラー・警告(致命的)なし |
| A4 | Vercelデプロイ→ログイン画面表示 | 5 | デプロイ後503/500エラーなし、SSR正常 |
| A5 | Prisma DB接続(Cold start) | 5 | コールドスタートから5秒以内にDB応答 |

## カテゴリ B: UX体験達成度 (40点)

| # | 評価項目 | 配点 | 基準 |
|---|---------|------|------|
| B1 | E1: 常に聴いている | 10 | FGS録音開始→バックグラウンド継続→10分自動分割→オフラインキュー蓄積 |
| B2 | E2: 分人別に整理される | 8 | ルールツリー公開→STT完了後にセグメントへbunjinId自動割当 |
| B3 | E3: 執事が一手を出す | 8 | 1日分テキスト→Gemini提案生成→提案表示→採用/却下 |
| B4 | E4: 軽く振り返る | 7 | 週次レビュー画面→Yes/No回答→実績表示 |
| B5 | E5: 執事が育つ | 7 | 採用メモリーappend→次回提案に反映 |

## カテゴリ C: API・データ整合性 (15点)

| # | 評価項目 | 配点 | 基準 |
|---|---------|------|------|
| C1 | sessionId整合性 | 5 | Flutter UUID ↔ サーバーID が一貫 |
| C2 | セグメント→分人自動割当 | 5 | RuleTree評価エンジンがSTT後に動作 |
| C3 | オフラインキュー一意制約 | 3 | (session_id, segment_no) 重複防止 |
| C4 | 認証フロー完全性 | 2 | JWT検証→userId取得→RLS適用 が全ルートで統一 |

## カテゴリ D: コード品質・セキュリティ (15点)

| # | 評価項目 | 配点 | 基準 |
|---|---------|------|------|
| D1 | エラーハンドリング統一 | 3 | withApi + AppError パターンが全APIで適用 |
| D2 | 未捕捉例外ハンドラ | 3 | Flutter/Web両方で未捕捉例外がログ出力・クラッシュ防止 |
| D3 | 環境変数バリデーション | 3 | 必須変数未設定時のフェイルファスト |
| D4 | CSP/セキュリティヘッダー | 3 | Content-Security-Policy、CORS設定 |
| D5 | ログ品質 | 3 | console.log排除、構造化ログ使用 |

---

## スコアリング

- **97-100点**: 合格 → 次フェーズに進行
- **90-96点**: 要改善 → 減点項目を修正し再評価(最大2回)
- **80-89点**: 大幅改善必要 → 根本原因分析 + 修正 + 再評価
- **80点未満**: フェーズ再設計 → 調査からやり直し

## 評価テンプレート

```
### Phase N 評価 (実施日: YYYY-MM-DD)

| カテゴリ | 配点 | 得点 | 減点理由 |
|---------|------|------|---------|
| A: 起動安定性 | 30 | ?? | |
| B: UX体験 | 40 | ?? | |
| C: データ整合性 | 15 | ?? | |
| D: コード品質 | 15 | ?? | |
| **合計** | **100** | **??** | |

判定: ○合格(97+) / △再帰処理 / ×フェーズ再設計
```
